#:schema node_modules/wrangler/config-schema.json
name = "briefcast"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Email Worker - handles incoming newsletter emails
[[email]]
name = "email-worker"
destination = "newsletters@your-domain.com"

# Scheduled Worker - daily aggregation and podcast generation
[triggers]
crons = ["0 5 * * *"]  # 05:00 UTC (06:00 CET), configurable via config.yaml

# KV Namespace - temporary email storage
[[kv_namespaces]]
binding = "EMAIL_STORE"
id = "your-kv-namespace-id"

# R2 Bucket - audio files, RSS feed, config.yaml
[[r2_buckets]]
binding = "PODCAST_BUCKET"
bucket_name = "briefcast-podcasts"

# Environment variables (use `wrangler secret put` for sensitive values)
[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "info"

# Build configuration
[build]
command = "npm run build"

[build.upload]
format = "modules"
main = "./dist/index.js"

# Development configuration
[env.dev]
name = "briefcast-dev"
vars = { ENVIRONMENT = "development", LOG_LEVEL = "debug" }

# API routes for manual controls
[[routes]]
pattern = "api.your-domain.com/*"
zone_name = "your-domain.com"

# Public R2 domain for podcast feed access
[[r2_buckets]]
binding = "PODCAST_BUCKET_PUBLIC"
bucket_name = "briefcast-podcasts"
